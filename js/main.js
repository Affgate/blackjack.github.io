class Blackjack{constructor(e){this.cards_dealer=e.cards_dealer,this.cards_player=e.cards_player,this.bet_parent=e.bet_parent,this.bet=e.bet,this.more=e.more,this.leave=e.leave,this.double=e.double,this.split=e.split,this.actions=[this.more,this.leave,this.double,this.split],this.control=[this.bet_parent,this.more.parentNode.parentNode],this.admin_list=e.admin_list,this.winner={},this.balance=e.balance}game_start(){console.log("Game start"),this.arr_bet=[],localStorage.amount_player?(this.balance.innerText=parseInt(localStorage.amount_player).toLocaleString("en-US"),0==parseInt(localStorage.amount_player)&&(this.control.forEach(e=>{e.classList.contains("hidden")||e.classList.add("hidden")}),localStorage.clear(),localStorage.setItem("amount_player",3500))):(localStorage.clear(),localStorage.setItem("amount_player",3500));for(let e of this.bet)e.addEventListener("click",e=>{const t=e.target;this.arr_bet.push(parseInt(t.innerText)),this.bets=this.arr_bet.reduce((e,t)=>e+t,0),this.admin_list.children[0].innerText="Ставка: "+this.bets.toLocaleString("en-US")+"$",this.inited||setTimeout(e=>{const t=parseInt(localStorage.amount_player)-this.bets;t<0?(this.bets=parseInt(localStorage.amount_player),this.admin_list.children[0].innerText="Ставка: "+this.bets.toLocaleString("en-US")+"$",this.balance.innerText=0,localStorage.amount_player=0):(this.balance.innerText=t,localStorage.amount_player=parseInt(localStorage.amount_player)-this.bets),this.bet_parent.classList.add("hidden"),this.distribution_of_cards()},3e3),this.inited=1})}generate_cards(e,t){const a=["A","K","Q","J",10,9,8,7,6,5,4,3,2],r={diamonds:[a,"diamonds",1],clubs:[a,"clubs",2],hearts:[a,"hearts",3],spades:[a,"spades",4]};for(let a=0;a<t;a++){let t=Math.floor(4*Math.random())+0,a=r[Object.keys(r)[t]],s=Math.floor(Math.random()*(a[0].length-1))+0;e.push({suit:a[2],card:a[0][s]})}}distribution_of_cards(){const e=[],t=[],a=[];this.generate_cards(e,2),this.generate_cards(a,2);const r={dealer:e,player:a};this.amount_cards(r),t.push(r.dealer[0]),this.cards_update(t,this.cards_dealer),this.cards_update(r.player,this.cards_player),this.admin_list.children[1].innerText="Игрок: "+r.amount_player,this.admin_list.children[2].innerText="Дилер: "+r.amount_dealer}amount_cards(e){const t={A:["A",11],K:["K",10],Q:["Q",10],J:["J",10]};let a=[],r=[];if(e.player.forEach(e=>a.push(e.card)),e.dealer.forEach(e=>r.push(e.card)),e.amount_player=this.amount_func(a,0,t),e.amount_dealer=this.amount_func(r,0,t),r){const a=r[r.length-1];if("string"==typeof a)for(let r of Object.keys(t))a==t[r][0]&&(e.amount_dealer=e.amount_dealer-t[r][1],e.real_amount_dealer=e.amount_dealer+t[r][1]);else e.amount_dealer=e.amount_dealer-a,e.real_amount_dealer=e.amount_dealer+a}this.choice(e,t,e.real_amount_dealer)}amount_func(e,t,a){return e.forEach(e=>{if("string"==typeof e)for(let r of Object.keys(a))e==a[r][0]&&(t+=a[r][1]);else"number"==typeof e&&(t+=e)}),t}create_cards(e,t,a){const r=document.createElement("li");r.setAttribute("data-aos","flip-left"),r.innerText=t.card,r.className=`bj-board__item ${a}`,e.appendChild(r)}cards_update(e,t){e.forEach(e=>{1==e.suit?this.create_cards(t,e,"diamonds"):2==e.suit?this.create_cards(t,e,"clubs"):3==e.suit?this.create_cards(t,e,"hearts"):4==e.suit&&this.create_cards(t,e,"spades")})}wait_end(e){setTimeout(t=>{this.game_end(e)},1e3)}amount_check_player(e){e.amount_player>21?(this.winner.amount_winner=e.real_amount_dealer,this.control[0].classList.add("hidden"),this.actions.forEach(e=>e.classList.add("inactive")),this.wait_end(e)):21==e.amount_player&&(this.winner.amount_winner=e.amount_player,this.control[0].classList.add("hidden"),this.wait_end(e))}amount_check_dealer(e){e.real_amount_dealer>21?(this.winner.amount_winner=e.amount_player,this.wait_end(e)):21==e.real_amount_dealer?(this.winner.amount_winner=e.real_amount_dealer,this.wait_end(e)):e.real_amount_dealer>e.amount_player?(this.winner.amount_winner=e.real_amount_dealer,this.wait_end(e)):e.real_amount_dealer==e.amount_player?(this.winner.tie=!0,this.wait_end(e)):(this.winner.amount_winner=e.amount_player,this.wait_end(e))}add_card(e,t,a,r,s){const n=document.createElement("li");return e.amount_users=this.amount_func(t,0,s),n.innerText=t[t.length-1],a.forEach(e=>{1==e?n.className="bj-board__item diamonds":2==e?n.className="bj-board__item clubs":3==e?n.className="bj-board__item hearts":4==e&&(n.className="bj-board__item spades")}),n.setAttribute("data-aos","flip-left"),r.appendChild(n),e.amount_users}mores(e,t){const a=[],r=[];this.generate_cards(e.player,1),e.player.forEach(e=>{a.push(e.card),r.push(e.suit)}),e.amount_player=this.add_card(e,a,r,this.cards_player,t),this.admin_list.children[1].innerText="Игрок: "+e.amount_player,this.amount_check_player(e),e.amount_player>=21&&this.more.classList.add("inactive")}leaves(e,t){this.actions.forEach(e=>e.classList.add("inactive"));for(let e of this.control[1].children[0].children)e.classList.add("inactive");for(let e of Object.keys(this.cards_dealer.children))this.cards_dealer.removeChild(this.cards_dealer.children[e]);if(this.cards_update(e.dealer,this.cards_dealer),e.real_amount_dealer<17)for(let a=e.real_amount_dealer;a<17;){if(!(e.real_amount_dealer<17)){this.amount_check_dealer(e);break}{const a=[],r=[];this.generate_cards(e.dealer,1),e.dealer.forEach(e=>{a.push(e.card),r.push(e.suit)}),e.real_amount_dealer=this.add_card(e,a,r,this.cards_dealer,t),this.admin_list.children[2].innerText="Дилер: "+e.real_amount_dealer}}else this.amount_check_dealer(e),this.admin_list.children[2].innerText="Дилер: "+e.real_amount_dealer}dual(e,t){this.mores(e,t),this.bets=2*this.bets,localStorage.amount_player=parseInt(localStorage.amount_player)-this.bets/2,this.admin_list.children[0].innerText="Ставка: "+this.bets.toLocaleString("en-US")+"$"}choice(e,t){if(this.amount_check_player(e),e.amount_player<21){this.control[1].classList.remove("hidden");const a=[],r=[];parseInt(localStorage.amount_player)>=2*this.bets||this.double.classList.add("inactive"),e.player.forEach(e=>{a.push(e.card)}),a.forEach(e=>{if("string"==typeof e)for(let a of Object.keys(t))e==t[a][0]&&r.push(t[a][1]);else"number"==typeof e&&a[0]!=a[1]&&this.split.classList.add("inactive")}),r[0]!=r[1]&&this.split.classList.add("inactive"),this.more.addEventListener("click",a=>{this.more.classList.contains("inactive")||(this.mores(e,t),this.double.classList.add("inactive"))}),this.double.addEventListener("click",a=>{this.double.classList.contains("inactive")||(this.dual(e,t),this.double.classList.add("inactive"))}),this.leave.addEventListener("click",a=>{this.leave.classList.contains("inactive")||this.leaves(e,t)})}}game_end(e){const t={dealer:["Рука дилера оказалась сильнее!",e.real_amount_dealer],player:["Рука игрока оказалась сильнее!",e.amount_player]};if(this.winner.tie)this.admin_list.children[3].innerText="Ничья.",localStorage.amount_player=parseInt(localStorage.amount_player)+this.bets,console.log(localStorage.amount_player);else for(let a of Object.keys(t))t[a][1]==this.winner.amount_winner&&(this.admin_list.children[3].innerText="Победитель: "+t[a][0],t[a][1]==e.amount_player?localStorage.amount_player?(localStorage.amount_player=2*this.bets+parseInt(localStorage.amount_player),this.balance.innerText=localStorage.amount_player):localStorage.amount_player=this.balance.innerText:(this.balance.innerText=localStorage.amount_player,parseInt(localStorage.amount_player)<=0?(localStorage.amount_player=0,this.balance.innerText=0):this.balance.innerText=localStorage.amount_player));setTimeout(()=>{location.reload()},2e3)}}const bj_obj={cards_dealer:document.querySelector(".dealer"),cards_player:document.querySelector(".player"),bet_parent:document.querySelector(".bj-board__bet"),bet:document.querySelectorAll(".bj-board__bet > ul > li"),more:document.querySelector(".bj-control__more"),leave:document.querySelector(".bj-control__leave"),double:document.querySelector(".bj-control__double"),split:document.querySelector(".bj-control__split"),admin_list:document.querySelector(".bj-admin__list"),balance:document.querySelector(".bj-balance")};let blackjack=new Blackjack(bj_obj);blackjack.game_start();
